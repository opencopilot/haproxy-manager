global
    daemon
    maxconn {{key (print "instances/" (env "INSTANCE_ID") "/services/LB/maxconn")}}

defaults
    mode http
    option httplog
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

frontend www
    bind *:80
    mode http
    default_backend backends

backend backends
    mode http
    balance roundrobin
    {{range (ls (print "instances/" (env "INSTANCE_ID") "/services/LB/backends"))}}
    server {{.Key}} {{.Value}}:80 check{{end}}
